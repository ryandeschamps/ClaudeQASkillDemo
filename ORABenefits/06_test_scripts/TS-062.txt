Test Script ID: TS-062
Test Scenario: Allocate Payments to Charges
Priority: Critical
Preconditions:
- Payments recorded but not yet allocated to charges
- Payment allocation batch process configured
- Allocation rules defined (FIFO, specific invoice, etc.)
- Outstanding charges exist for employees
- Credit and arrears management enabled

GIVEN: Payments have been recorded but need to be allocated to outstanding charges
WHEN: Payroll administrator runs payment allocation process to match payments to charges
THEN: Payments successfully allocated to charges, balances updated, and billing status current

Test Steps:
1. Batch payments uploaded: 1,498 payments totaling $425,850
2. Payment status: "Recorded - Pending Allocation"
3. Outstanding charges exist for all employees
4. Payroll administrator logs into Oracle Fusion HCM
5. Navigate to "Benefits Billing" or "Payment Allocation"
6. Click "Run Payment Allocation" or "Allocate Payments"
7. System displays allocation parameters:
   - Payment batch: PAY-BATCH-2024-11-15
   - Allocation method: FIFO (First In, First Out)
   - Allocation date: 2024-11-15
8. Review allocation rules:
   - Oldest outstanding charges paid first
   - Payment allocated to charges for same employee
   - Overpayments create credit balance
   - Underpayments create arrears
9. Click "Run Allocation Process"
10. System processes payment allocation:
    - Match payments to employees via Person_Number
    - Identify outstanding charges for each employee
    - Allocate payment to oldest charges first (FIFO)
    - Update charge status: "Paid" when fully allocated
    - Create credits for overpayments
    - Create arrears for underpayments
11. Allocation processing completes
12. Review allocation results:
    - Payments allocated: 1,498
    - Charges fully paid: 1,480
    - Credits created: 12 employees (overpayments)
    - Arrears created: 6 employees (underpayments)
13. Review specific allocation examples:
    - Employee A: Payment $237, Charges $237 → Fully Paid ✓
    - Employee B: Payment $250, Charges $237 → Fully Paid + $13 Credit
    - Employee C: Payment $200, Charges $237 → Partially Paid + $37 Arrears
14. Click on employee with credit to review:
    - Payment: $250.00
    - Charges: $237.00
    - Credit balance: $13.00 (to be applied to next month)
15. Click on employee with arrears to review:
    - Payment: $200.00
    - Charges: $237.00
    - Arrears: $37.00 (to be collected next billing)
16. Generate allocation report:
    - Total allocated: $425,850
    - Fully paid invoices: 1,480
    - Credits created: $156 total across 12 employees
    - Arrears created: $222 total across 6 employees
17. Export report for accounting reconciliation
18. System sends notifications for arrears (optional)

Expected Result:
- Payment allocation process easily initiated
- Allocation parameters and rules clearly configurable
- Allocation method (FIFO) properly applied
- Payments automatically matched to employees
- Charges identified and payments allocated appropriately
- Fully paid charges marked as "Paid"
- Overpayments create credit balances automatically
- Underpayments create arrears automatically
- Allocation results comprehensive and detailed
- Individual employee allocations reviewable
- Credit and arrears properly calculated and recorded
- Allocation report generated with all details
- Report suitable for accounting reconciliation
- Billing status accurately reflects allocation results
- Employees notified of arrears if configured

Test Data Reference:
- All employees with payments and charges
- Scenarios requiring:
  - Exact payment matching charge
  - Overpayment creating credit
  - Underpayment creating arrears
  - Multiple charges requiring allocation priority

Notes:
- Verify allocation process handles large volumes efficiently
- Confirm FIFO and other allocation methods work correctly
- Test credit creation and management for overpayments
- Verify arrears creation and tracking for underpayments
- Ensure allocation results accurate and reconcilable
- Test that allocation updates billing status in real-time
- Confirm integration with accounting system
- Verify notification process for employees with arrears
- Test manual allocation override if automatic allocation incorrect
- Ensure audit trail captures all allocation transactions
