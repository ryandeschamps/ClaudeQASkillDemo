Test Script ID: TS-063
Test Scenario: Create Credit for Overpayment
Priority: High
Preconditions:
- Payment allocation process completed
- Employee payment exceeds outstanding charges
- Credit management functionality enabled
- Credit balance tracking configured
- Credit application rules defined

GIVEN: An employee payment ($250) exceeds outstanding charges ($237) resulting in overpayment
WHEN: Payment allocation process identifies overpayment and creates credit
THEN: Credit balance successfully created, tracked, and available for future charge application

Test Steps:
1. Employee payment processed: $250.00
2. Outstanding charges for employee: $237.00
3. Overpayment amount: $13.00
4. Payment allocation process runs
5. System identifies overpayment for employee
6. System automatically creates credit balance
7. Benefits administrator reviews credits created
8. Navigate to "Credits and Adjustments" or "Credit Management"
9. Filter to show recent credits: Created date 2024-11-15
10. Review credit listing:
    - Employee: Sarah Johnson
    - Person Number: P100025
    - Credit amount: $13.00
    - Credit date: 2024-11-15
    - Reason: Overpayment from batch payment
    - Status: Available for application
11. Click on credit to view details:
    - Original payment: $250.00
    - Charges paid: $237.00
    - Credit created: $13.00
    - Available balance: $13.00
12. View employee's billing account:
    - Current charges: $0.00 (fully paid)
    - Credit balance: $13.00
    - Next billing cycle charges: $237.00 (anticipated)
13. Next billing cycle arrives (December 2024)
14. New charges generated: $237.00
15. System automatically applies credit during allocation
16. Credit application:
    - December charges: $237.00
    - Credit applied: -$13.00
    - Net amount due: $224.00
17. Employee's December payroll deduction: $224.00 (reduced by credit)
18. Credit fully consumed:
    - Original credit: $13.00
    - Applied to December charges: $13.00
    - Remaining credit balance: $0.00
19. Generate credit activity report showing:
    - Credits created during period
    - Credits applied during period
    - Outstanding credit balances
20. Verify credit properly reduced employee's next payment obligation

Expected Result:
- Overpayment automatically detected during allocation
- Credit balance automatically created for overpayment amount
- Credit amount accurately calculated ($13.00)
- Credit recorded with clear reason (overpayment)
- Credit status shows "Available for application"
- Credit visible in employee's billing account
- Credit balance tracked separately from charges
- Credit automatically applied to next period's charges
- Application reduces amount due appropriately
- Employee's payment obligation reduced by credit
- Credit fully consumed when applied
- Credit balance updated to $0.00 after full application
- Credit activity tracked and reportable
- Audit trail captures credit creation and application

Test Data Reference:
- Overpayment scenarios
- Common causes:
  - Employee pays full amount when charges were less
  - Coverage termination mid-period with full payment made
  - Manual payment error (paying too much)
  - Premium rate decrease retroactive adjustment

Notes:
- Verify credit creation is automatic during allocation
- Confirm credit amount calculation accurate
- Test credit balance tracking and visibility
- Verify automatic credit application to future charges
- Ensure credit reduces payment obligation appropriately
- Test credit expiration rules if applicable
- Confirm credit can be manually applied if needed
- Verify credit cannot be applied twice
- Test credit refund process for large unused credits
- Ensure employee notification of credit balance
