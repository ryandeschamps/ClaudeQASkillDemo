TEST SCRIPT: TS-051
Test Scenario: Verify Purchase Before Review
User Story: As a System, I want to verify that a buyer purchased a product before allowing a review, so that I can ensure only genuine customers can review products
Priority: High
Related Requirements: FR-011

GIVEN a product exists in the catalog
  AND users can view the product details page

WHEN a logged-in user who has NOT purchased the product
  AND views the product details page

THEN the system should:
  - Not display "Write a Review" button
  - Display message like "Purchase this product to write a review"
  - Show existing reviews from verified purchasers

WHEN a logged-in user who HAS purchased the product
  AND the order has been delivered or marked complete
  AND views the product details page

THEN the system should:
  - Display "Write a Review" button
  - Allow the user to submit a review

WHEN a user attempts to submit a review via API or direct URL
  AND has not purchased the product

THEN the system should:
  - Reject the review submission
  - Return appropriate error message
  - Log the attempt (security)

WHEN checking purchase verification

THEN the system should validate:
  - User has an order containing the product
  - Order status is Delivered or Completed
  - Product was part of a successful purchase

EXPECTED RESULT:
- Only verified purchasers can write reviews
- Purchase verification is enforced at UI and API level
- Non-purchasers see appropriate messaging
- Verified purchase badge/indicator appears on reviews
- System prevents fraudulent review submissions
- Purchase verification is automated and accurate
- Review authenticity is maintained
