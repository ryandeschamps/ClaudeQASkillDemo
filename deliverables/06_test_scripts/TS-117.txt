TEST SCRIPT: TS-117
Test Scenario: Process Stripe Payment
User Story: As a System, I want to integrate with Stripe payment gateway, so that I can securely process customer payments
Priority: Critical
Related Requirements: FR-020

GIVEN Stripe payment gateway is configured in the system
  AND Stripe API keys are set up correctly
  AND a customer is on the payment page with items in cart

WHEN the customer enters payment details:
  - Card number
  - Expiry date
  - CVV
  - Cardholder name
  AND submits payment

THEN the system should:
  - Send payment request to Stripe API
  - Include order amount and currency
  - Include customer and order details
  - Wait for Stripe response
  - Handle the response appropriately

WHEN Stripe approves the payment

THEN the system should:
  - Receive successful payment confirmation
  - Get transaction ID from Stripe
  - Create the order in database
  - Mark order as paid
  - Display success message to customer
  - Send order confirmation email

WHEN Stripe declines the payment

THEN the system should:
  - Receive decline response with reason
  - Not create the order
  - Display error message to customer
  - Allow customer to retry with different payment method

WHEN there is a network error or timeout

THEN the system should:
  - Handle the timeout gracefully
  - Display appropriate error message
  - Not create duplicate orders on retry
  - Log the error for investigation

WHEN processing payment data

THEN the system should:
  - Never store card details locally
  - Send card data directly to Stripe (tokenization)
  - Use HTTPS/SSL for all communication
  - Comply with PCI DSS requirements

EXPECTED RESULT:
- Stripe integration works correctly
- Successful payments create orders
- Failed payments are handled properly
- Payment security is maintained
- No sensitive card data is stored locally
- Transaction IDs are recorded
- Error handling is robust
- Communication with Stripe is secure
- System complies with payment security standards
